/*! loystar-woocommerce-loyalty-program 2.1.0 */

var $=jQuery;$("."+wcLsJson.dobInput).datepicker({changeYear:!0,defaultDate:new Date(1910,1,1),yearRange:wcLsJson.dateRange,dateFormat:"dd/mm/yy"});var wcLsPhoneErrorMap=["Invalid number","Invalid country code","Too short","Too long","Invalid number"],wcLsPhoneIntl=$(".wc-ls-intl input").intlTelInput({utilsScript:wcLsJson.utilsScript}),wcLsphoneErrMsg="";function wcLsValidatePhone(e){const o=e;let n=!1;if(1==o.intlTelInput("isValidNumber"))n=o.intlTelInput("getNumber");else{let e=o.intlTelInput("getValidationError");wcLsphoneErrMsg=`Phone validation error: ${wcLsPhoneErrorMap[e]}`}return n}function wcLsLoyaltySubmit(){let e="form.ls-loyalty-widget-box";$(e).prepend('<div class="ls-blanket center"><a href="#no-click" class="ls-nice-load-feel"><i class="fa fa-gear fa-spin fa-2x"></i></a> </div>'),$(e).css("position","relative");let o={},n=$(e).serializeArray();if(void 0===n||n.length<1)return wcLsShowWidgetNote("Please fill in the details","danger"),void wcLsRemoveOverlay(e);let t={};for(let e=0;e<n.length;e++)t[n[e].name]=n[e].value;if(t.u_id=wcLsJson.userId,t.nonce=wcLsJson.nonce,t.phone=wcLsValidatePhone(wcLsPhoneIntl),0==t.phone)return wcLsShowWidgetNote(wcLsphoneErrMsg,"danger"),void wcLsRemoveOverlay(e);o=t,$.ajax({url:wcLsJson.url+"wc_ls/v1/loyalty_widget/",method:"POST",beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",wcLsJson.nonce)},data:o}).success(function(o){wcLsShowWidgetNote(o,"success"),wcLsRemoveOverlay(e),window.setTimeout(function(){window.location.href=wcLsJson.pageUrl},3e3)}).fail(function(o){const n=o.status;let t="";response=JSON.parse(o.responseText),wcLsShowWidgetNote(t=422!==n&&503!==n?"Sorry, an internal error occured, try again later.":response,"danger"),wcLsRemoveOverlay(e)})}function wcLsShowWidgetNote(e,o="success"){const n="form.ls-loyalty-widget-box .wc-ls-alert";$(n).attr("class","wc-ls-alert ls-"+o),$(n).text(e),$(n).removeClass("hidden"),$(n).fadeIn("slow")}function wcLsRemoveOverlay(e="form.ls-loyalty-widget-box"){$(e+" .ls-blanket").remove()}var wcLsCheckoutForm=$(".woocommerce-checkout");wcLsCheckoutForm.on("checkout_place_order",function(){let e=jQuery,o=wcLsValidatePhone(wcLsPhoneIntl);0!=o?(e(".woocommerce-checkout input#billing_phone").val(o),0==e("#wc-ls-phone-valid-field").length&&wcLsCheckoutForm.append(`<input id="wc-ls-phone-valid-field" value="${o}" type="hidden" name="${wcLsJson.phoneValidatorName}">`)):0==e("#wc-ls-phone-valid-field-err-msg").length&&wcLsCheckoutForm.append(`<input id="wc-ls-phone-valid-field-err-msg" value="${wcLsphoneErrMsg}" type="hidden" name="${wcLsJson.phoneValidatorErrName}">`)});